<!-- Re-display the question part from the front -->
<div class="main-display">{{Picture}}</div>
<!-- Container for the ANSWER MCQ with a unique ID -->
<div id="mcq-container-back"></div>

<hr id=answer>

<script>
// --- BACK TEMPLATE SCRIPT (FULLY SEPARATED) ---
function simpleHash_back(str) { let hash = 0; for (let i = 0; i < str.length; i++) { const char = str.charCodeAt(i); hash = ((hash << 5) - hash) + char; hash |= 0; } return Math.abs(hash); }
const config_back = { currentCharacter: "{{Character}}", currentRepresentationHTML: `{{Picture}}` };
const cardId_back = simpleHash_back(config_back.currentCharacter);
let currentRepresentationValue_back = "";
const imgMatch_back = config_back.currentRepresentationHTML.match(/src="?([^"\s>]+)"?/);
if (imgMatch_back && imgMatch_back[1]) { currentRepresentationValue_back = imgMatch_back[1]; } else { const tempDiv_back = document.createElement('div'); tempDiv_back.innerHTML = config_back.currentRepresentationHTML; currentRepresentationValue_back = (tempDiv_back.textContent || tempDiv_back.innerText || "").trim(); }

(async function initMCQ_back() {
    const mcqContainer_back = document.getElementById('mcq-container-back');
    if (!mcqContainer_back) return;
    try {
        const response = await fetch('_anki_mcq_data.json');
        if (!response.ok) return; // Silently fail on back if file not found
        const allNotesData = await response.json();
        const otherNotes = allNotesData.filter(note => note.representation !== currentRepresentationValue_back);
        if (otherNotes.length < 3) { return; }
        function mulberry32_back(a) { return function() { var t = a += 0x6D2B79F5; t = Math.imul(t ^ t >>> 15, t | 1); t ^= t + Math.imul(t ^ t >>> 7, t | 61); return ((t ^ t >>> 14) >>> 0) / 4294967296; } }
        const random_back = mulberry32_back(cardId_back);
        function shuffle_back(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(random_back() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }
        function generateCharTable_back(options, correctChar) {
            let html = `<table class="mcq-table"><tr>`;
            options.forEach(char => {
                const highlightClass = (char === correctChar) ? 'correct-answer-char' : '';
                html += `<td class="char-cell ${highlightClass}">${char}</td>`;
            });
            return html + '</tr></table>';
        }
        const distractors = shuffle_back([...otherNotes]).slice(0, 3);
        const charOptions = shuffle_back(distractors.map(d => d.character).concat([config_back.currentCharacter]));
        mcqContainer_back.innerHTML = generateCharTable_back(charOptions, config_back.currentCharacter);
    } catch (e) { /* Silently fail on back */ }
})();
</script>

<div class="main-display">{{Character}}</div>
<div id="char-mcq-choices-4"></div>
<script>
if ("{{Card}}" === "4. MCQ (Pick Pic)") {
(async function() {
    const correctRep = `{{Representation}}`;
    const correctChar = "{{Character}}";
    const render = v => {
        if (v.startsWith('<img')) return v;
        if (/\.(jpe?g|png|gif|svg)$/i.test(v)) return `<img src="${v}">`;
        return `<span class="pinyin-cell">${v}</span>`;
    };
    try {
        const r = await fetch('_anki_mcq_data.json'); if (!r.ok) throw new Error();
        const d = await r.json();
        const others = d.filter(item => item.character !== correctChar).map(item => item.representation);
        if (others.length < 3) return;
        const shuffle = a => { for (let i=a.length-1; i>0; i--) { const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; };
        const choices = shuffle([correctRep, ...shuffle(others).slice(0, 3)]);
        window.ankiCharMcq4Choices = { choices: choices, correct: correctRep };
        let h = '<table class="char-mcq-table"><tr>';
        choices.forEach(c => {
            const isCorrect = c === correctRep;
            h += `<td class="rep-cell" data-correct="${isCorrect}" onclick="if(this.dataset.correct === 'true') try { new Audio('bell.wav').play() } catch(e) {}">${render(c)}</td>`;
        });
        document.getElementById('char-mcq-choices-4').innerHTML = h + '</tr></table>';
    } catch(e) {}
})();
}
</script>

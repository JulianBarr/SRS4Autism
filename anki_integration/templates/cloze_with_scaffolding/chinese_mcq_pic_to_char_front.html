<div class="main-display">{{Representation}}</div>
<div id="char-mcq-choices-3"></div>
<script>
if ("{{Card}}" === "3. MCQ (Pick Char)") {
(async function() {
    const correctChar = "{{Character}}";
    const currentRep = `{{Representation}}`;
    try {
        const r = await fetch('_anki_mcq_data.json'); if (!r.ok) throw new Error();
        const d = await r.json();
        const others = d.filter(item => item.representation !== currentRep).map(item => item.character);
        if (others.length < 3) return;
        const shuffle = a => { for (let i=a.length-1; i>0; i--) { const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; };
        const choices = shuffle([correctChar, ...shuffle(others).slice(0, 3)]);
        window.ankiCharMcq3Choices = { choices: choices, correct: correctChar };
        let h = '<table class="char-mcq-table"><tr>';
        choices.forEach(c => {
            const isCorrect = c === correctChar;
            h += `<td class="char-cell" data-correct="${isCorrect}" onclick="if(this.dataset.correct === 'true') try { new Audio('bell.wav').play() } catch(e) {}">${c}</td>`;
        });
        document.getElementById('char-mcq-choices-3').innerHTML = h + '</tr></table>';
    } catch(e) {}
})();
}
</script>

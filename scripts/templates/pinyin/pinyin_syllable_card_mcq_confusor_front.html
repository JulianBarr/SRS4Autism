{{#ElementToLearn}}
{{WordAudio}}

<div class="pinyin-syllable-card">
  {{#WordPicture}}<div class="word-picture">{{WordPicture}}</div>{{/WordPicture}}
  <div class="word-display"><p class="word-hanzi">{{WordHanzi}}</p></div>
  
  <div class="mcq-options" id="mcq-confusor-front">
    <button class="mcq-option" data-value="{{Syllable}}">{{Syllable}}</button>
    <button class="mcq-option" data-value="{{Confusor1}}">{{Confusor1}}</button>
    <button class="mcq-option" data-value="{{Confusor2}}">{{Confusor2}}</button>
    <button class="mcq-option" data-value="{{Confusor3}}">{{Confusor3}}</button>
  </div>
</div>

<script>
(function() {
  const container = document.getElementById('mcq-confusor-front');
  
  // CRITICAL FIX: Only shuffle if we are NOT on the back side.
  // The element with id="answer" only exists on the Back Template.
  if (!document.getElementById('answer')) {
    for (let i = container.children.length; i >= 0; i--) {
      container.appendChild(container.children[Math.random() * i | 0]);
    }
  }
  
  const options = container.querySelectorAll('.mcq-option');
  const correctAnswer = '{{Syllable}}';
  
  options.forEach(btn => {
    btn.addEventListener('click', function() {
      const isCorrect = (this.getAttribute('data-value') === correctAnswer);
      options.forEach(opt => opt.classList.remove('selected', 'wrong'));
      
      if (isCorrect) {
        this.classList.add('selected');
        if(typeof pycmd !== "undefined") { pycmd("ans"); }
      } else {
        this.classList.add('wrong');
        // Highlight real answer
        options.forEach(opt => {
          if (opt.getAttribute('data-value') === correctAnswer) opt.classList.add('selected');
        });
      }
    });
  });
})();
</script>
{{/ElementToLearn}}
